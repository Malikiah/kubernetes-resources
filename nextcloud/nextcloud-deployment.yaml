apiVersion: apps/v1
kind: Deployment

metadata:
  name: nexcloud-deployment
  labels:
    app: nextcloud

spec:
  replicas: 2
  selector:
    matchLabels:
      app: nextcloud

  template:
    spec:
      containers:
        - name: nextcloud
          image: nextcloud:fpm

        ports:
          - containerPort: 9000

        env:
          - name: MYSQL_DATABASE
              valueFrom:
                secretKeyRef:
                  key: MYSQL_DATABASE
                  name: db-secrets

        volumeMounts:
          - mountPath: /home/malikiah/public_html/nextcloud
            name: nextcloud-persistent-storage

      restartPolicy: Always

      volumes:
        - name: nextcloud-persistent-storage
          persistentVolumeClaim:
            claimName: nextcloud-pvc